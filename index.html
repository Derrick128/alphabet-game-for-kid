<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—æ¯èˆ‡æ•¸å­¸å°åµæ¢ (ä¿®æ­£ç‰ˆ)</title>
    <style>
        /* --- CSS æ¨£å¼è¨­è¨ˆ (èˆ‡å‰ä¸€å€‹ç‰ˆæœ¬ç›¸åŒï¼Œä¿æŒç¾è§€) --- */
        body {
            font-family: 'Arial Black', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            color: #333;
        }

        #game-container {
            width: 90%;
            max-width: 800px;
            background-color: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            color: #ff6f61; /* æº«æš–çš„ç´…è‰² */
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        #level-display {
            font-size: 1.5em;
            color: #1a535c; /* æ·±é’è‰² */
            margin-bottom: 20px;
        }

        #instruction-area {
            font-size: 1.8em;
            color: #4ecdc4; /* ç¶ æ¾çŸ³è‰² */
            margin-bottom: 30px;
            min-height: 40px;
            padding: 5px;
        }

        #game-area {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            min-height: 200px; 
        }

        .game-button {
            width: 45%;
            padding: 20px 10px;
            font-size: 3em; 
            border: 5px solid #ff6f61;
            border-radius: 15px;
            background-color: #ffeaa7; 
            cursor: pointer;
            transition: all 0.1s ease;
            user-select: none;
            box-shadow: 0 5px 0 #e15f51;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .math-button {
             width: 30%;
             font-size: 3.5em;
             padding: 15px 5px;
        }

        .game-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #e15f51;
        }

        .game-button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #e15f51;
        }

        /* åé¥‹é¡è‰² */
        .correct {
            background-color: #4cd6a6 !important; /* ç¶ è‰² */
            border-color: #3aa884 !important;
        }

        .incorrect {
            background-color: #ff7675 !important; /* ç´…è‰² */
            border-color: #cc5e5e !important;
        }

        #feedback-area {
            font-size: 1.8em;
            margin-top: 20px;
            min-height: 30px;
            color: #ff6f61;
        }

        #start-button {
            padding: 15px 30px;
            font-size: 1.5em;
            background-color: #4ecdc4;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 0 #3aa884;
            transition: background-color 0.1s;
        }

        #start-button:hover {
            background-color: #3aa884;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <h1>å­—æ¯èˆ‡æ•¸å­¸å°åµæ¢ ğŸ•µï¸â€â™€ï¸ğŸ”¢</h1>
        <div id="level-display">é—œå¡: 0 / 5</div>
        <div id="instruction-area">é»æ“Šã€Œé–‹å§‹éŠæˆ²ã€ä¾†å•Ÿå‹•æŒ‘æˆ°ï¼</div>
        
        <div id="game-area">
            </div>

        <div id="feedback-area"></div>
        <button id="start-button" onclick="handleStartClick()">é–‹å§‹éŠæˆ²</button>
    </div>

    <script>
        // --- æ ¸å¿ƒè³‡æ–™çµæ§‹ ---
        
        const ALPHABET = [
            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 
            'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'
        ];

        const PHONICS_WORDS = [
            { letter: 'A', word: 'Apple', alt: 'ğŸ è˜‹æœ', sound: 'A' },
            { letter: 'B', word: 'Ball', alt: 'âš½ çƒ', sound: 'B' },
            { letter: 'C', word: 'Cat', alt: 'ğŸˆ è²“', sound: 'C' },
            { letter: 'D', word: 'Dog', alt: 'ğŸ• ç‹—', sound: 'D' },
            { letter: 'E', word: 'Egg', alt: 'ğŸ¥š è›‹', sound: 'E' },
            { letter: 'S', word: 'Sun', alt: 'â˜€ï¸ å¤ªé™½', sound: 'S' },
            { letter: 'T', word: 'Tree', alt: 'ğŸŒ² æ¨¹', sound: 'T' },
            { letter: 'Z', word: 'Zip', alt: 'ğŸ‘ æ‹‰éŠ', sound: 'Z' },
        ];
        
        // --- å…¨åŸŸç‹€æ…‹è®Šæ•¸ ---
        let currentLevel = 0;
        let targetAnswer = '';
        const MAX_LEVELS = 5;
        let levelTypes = [];

        // --- DOM å…ƒç´ å¿«å– ---
        const gameArea = document.getElementById('game-area');
        const instructionArea = document.getElementById('instruction-area');
        const feedbackArea = document.getElementById('feedback-area');
        const levelDisplay = document.getElementById('level-display');
        const startButton = document.getElementById('start-button');

        // --- ä¿®æ­£å¾Œçš„å•Ÿå‹•é» ---
        function handleStartClick() {
            // ä¿®æ­£ï¼šç•¶ä½¿ç”¨è€…é»æ“Šå¾Œï¼Œå…ˆå¼·åˆ¶æ’­æ”¾ä¸€å€‹éœéŸ³ï¼Œä»¥è§£é™¤ç€è¦½å™¨çš„èªéŸ³é™åˆ¶
            speak(' '); 
            startGame();
        }

        // --- è¼”åŠ©å‡½å¼ ---

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * æ’­æ”¾èªéŸ³ï¼Œä¸¦è™•ç†èªéŸ³å¼•æ“æœªè¼‰å…¥çš„å•é¡Œ
         * @param {string} text è¦æœ—è®€çš„æ–‡å­—
         */
        function speak(text) {
            if ('speechSynthesis' in window) {
                // ä¿®æ­£ï¼šç¢ºä¿èªéŸ³å¼•æ“å·²ç¶“è¼‰å…¥
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) {
                     // å¦‚æœæ²’æœ‰è¼‰å…¥ï¼Œå˜—è©¦è§¸ç™¼è¼‰å…¥
                     speechSynthesis.onvoiceschanged = () => speak(text);
                     return; 
                }
                
                let voice = voices.find(v => v.lang === 'en-US' || v.lang === 'en-GB') || voices[0];
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = voice;
                utterance.pitch = 1.0;
                utterance.rate = 0.8; 
                
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(utterance);
            } else {
                instructionArea.textContent = 'ğŸ”Š è«‹æ‰¾å‡º: ' + text;
            }
        }

        // --- éŠæˆ²æµç¨‹å‡½å¼ ---

        function startGame() {
            currentLevel = 0;
            startButton.style.display = 'none';
            // é—œå¡é †åºè¨­å®š
            levelTypes = ['alphabet', 'phonics', 'alphabet', 'addition', 'subtraction'];
            levelDisplay.textContent = `é—œå¡: ${currentLevel} / ${MAX_LEVELS}`;
            nextLevel();
        }

        function nextLevel() {
            if (currentLevel >= MAX_LEVELS) {
                endGame();
                return;
            }

            currentLevel++;
            levelDisplay.textContent = `é—œå¡: ${currentLevel} / ${MAX_LEVELS}`;
            feedbackArea.textContent = '';
            gameArea.innerHTML = ''; 

            const levelType = levelTypes[currentLevel - 1];
            
            if (levelType === 'alphabet') {
                loadAlphabetChallenge();
            } else if (levelType === 'phonics') {
                loadPhonicsChallenge();
            } else if (levelType === 'addition') {
                loadAdditionChallenge();
            } else if (levelType === 'subtraction') {
                loadSubtractionChallenge();
            }
        }

        function checkAnswer(selectedAnswer, buttonElement) {
            gameArea.querySelectorAll('.game-button').forEach(btn => btn.onclick = null);
            
            // ç¢ºä¿æ¯”è¼ƒæ™‚ï¼Œæ•¸å­—å’Œå­—ä¸²éƒ½èƒ½æ­£ç¢ºæ¯”å°
            const isCorrect = (typeof selectedAnswer === 'string' && selectedAnswer.trim() === targetAnswer.trim()) || 
                              (selectedAnswer == targetAnswer); // æ•¸å­—æ¯”è¼ƒ

            if (isCorrect) {
                buttonElement.classList.add('correct');
                feedbackArea.textContent = 'ğŸŒŸ å¤ªæ£’äº†ï¼ç­”å°äº†ï¼';
                speak('Great job!'); 
            } else {
                buttonElement.classList.add('incorrect');
                gameArea.querySelectorAll('.game-button').forEach(btn => {
                    if (btn.textContent.trim() == targetAnswer) {
                        btn.classList.add('correct');
                    }
                });
                feedbackArea.textContent = `âŒ éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${targetAnswer}ã€‚`;
                speak('Oh no. Try the next one.'); 
            }

            setTimeout(() => {
                nextLevel();
            }, 3000); 
        }

        function endGame() {
            instructionArea.textContent = 'æ­å–œæ‚¨å®Œæˆäº†æ‰€æœ‰æŒ‘æˆ°ï¼';
            feedbackArea.textContent = 'ä½ æ˜¯æœ€æ£’çš„åµæ¢ï¼';
            gameArea.innerHTML = '';
            startButton.textContent = 'å†ç©ä¸€æ¬¡';
            startButton.onclick = handleStartClick; // ä½¿ç”¨ä¿®æ­£å¾Œçš„é»æ“Šè™•ç†å™¨
            startButton.style.display = 'block';
        }

        // --- é—œå¡å¯¦ä½œï¼šå­—æ¯è½åŠ› (Level 1, 3) ---
        function loadAlphabetChallenge() {
            const levelTargetLetter = ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
            targetAnswer = levelTargetLetter; 

            let choices = new Set([levelTargetLetter]);
            while (choices.size < 4) {
                const randomLetter = ALPHABET[Math.floor(Math.
