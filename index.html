<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—æ¯èˆ‡æ•¸å­¸å°åµæ¢ (æ™‰ç´šç‰ˆ)</title>
    <style>
        /* --- CSS æ¨£å¼è¨­è¨ˆ (èˆ‡å‰ä¸€å€‹ç‰ˆæœ¬ç›¸åŒï¼Œä¿æŒç¾è§€) --- */
        body {
            font-family: 'Arial Black', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            color: #333;
        }

        #game-container {
            width: 90%;
            max-width: 800px;
            background-color: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            color: #ff6f61;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        #level-display {
            font-size: 1.5em;
            color: #1a535c;
            margin-bottom: 20px;
        }

        #instruction-area {
            font-size: 1.8em;
            color: #4ecdc4;
            margin-bottom: 30px;
            min-height: 40px;
            padding: 5px;
        }
        
        /* æ–°å¢ï¼šåˆ†æ•¸é¡¯ç¤ºå€å¡Š */
        #score-display {
            font-size: 1.2em;
            color: #1a535c;
            margin-top: 10px;
        }

        #game-area {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            min-height: 200px; 
        }

        .game-button {
            width: 45%;
            padding: 20px 10px;
            font-size: 3em; 
            border: 5px solid #ff6f61;
            border-radius: 15px;
            background-color: #ffeaa7; 
            cursor: pointer;
            transition: all 0.1s ease;
            user-select: none;
            box-shadow: 0 5px 0 #e15f51;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .math-button {
             width: 30%;
             font-size: 3.5em;
             padding: 15px 5px;
        }

        .game-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #e15f51;
        }

        .game-button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #e15f51;
        }

        /* åé¥‹é¡è‰² */
        .correct {
            background-color: #4cd6a6 !important;
            border-color: #3aa884 !important;
        }

        .incorrect {
            background-color: #ff7675 !important;
            border-color: #cc5e5e !important;
        }

        #feedback-area {
            font-size: 1.8em;
            margin-top: 20px;
            min-height: 30px;
            color: #ff6f61;
        }

        #start-button {
            padding: 15px 30px;
            font-size: 1.5em;
            background-color: #4ecdc4;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 0 #3aa884;
            transition: background-color 0.1s;
        }

        #start-button:hover {
            background-color: #3aa884;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <h1>å­—æ¯èˆ‡æ•¸å­¸å°åµæ¢ ğŸ•µï¸â€â™€ï¸ğŸ”¢</h1>
        <div id="level-display">é—œå¡: 0 / 5</div>
        <div id="instruction-area">é»æ“Šã€Œé–‹å§‹éŠæˆ²ã€ä¾†å•Ÿå‹•æŒ‘æˆ°ï¼</div>
        
        <div id="game-area">
            </div>
        
        <div id="score-display"></div> 

        <div id="feedback-area"></div>
        <button id="start-button" onclick="handleStartClick()">é–‹å§‹éŠæˆ²</button>
    </div>

    <script>
        // --- æ ¸å¿ƒè³‡æ–™çµæ§‹ ---
        
        const ALPHABET = [
            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 
            'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'
        ];

        const PHONICS_WORDS = [
            { letter: 'A', word: 'Apple', alt: 'ğŸ è˜‹æœ', sound: 'A' },
            { letter: 'B', word: 'Ball', alt: 'âš½ çƒ', sound: 'B' },
            { letter: 'C', word: 'Cat', alt: 'ğŸˆ è²“', sound: 'C' },
            { letter: 'D', word: 'Dog', alt: 'ğŸ• ç‹—', sound: 'D' },
            { letter: 'E', word: 'Egg', alt: 'ğŸ¥š è›‹', sound: 'E' },
            { letter: 'S', word: 'Sun', alt: 'â˜€ï¸ å¤ªé™½', sound: 'S' },
            { letter: 'T', word: 'Tree', alt: 'ğŸŒ² æ¨¹', sound: 'T' },
            { letter: 'Z', word: 'Zip', alt: 'ğŸ‘ æ‹‰éŠ', sound: 'Z' },
        ];
        
        // --- å…¨åŸŸç‹€æ…‹è®Šæ•¸ ---
        let currentLevel = 0; // ç•¶å‰çš„å¤§é—œå¡è™Ÿ (1-5)
        let currentRound = 0; // ç•¶å‰é—œå¡å…§çš„å°é¡Œè™Ÿ (1-10)
        let score = 0;      // ç•¶å‰é—œå¡çš„å¾—åˆ†
        let targetAnswer = '';
        const MAX_LEVELS = 5;
        const MAX_ROUNDS = 10; // æ¯å€‹å¤§é—œæœ‰ 10 é¡Œ
        const PASS_SCORE = 9;  // æ™‰ç´šåˆ†æ•¸ï¼š9 åˆ†ä»¥ä¸Š

        // é—œå¡é¡å‹å®šç¾©ï¼š
        const levelTypes = ['alphabet', 'phonics', 'alphabet', 'addition', 'subtraction'];

        // --- DOM å…ƒç´ å¿«å– ---
        const gameArea = document.getElementById('game-area');
        const instructionArea = document.getElementById('instruction-area');
        const feedbackArea = document.getElementById('feedback-area');
        const levelDisplay = document.getElementById('level-display');
        const scoreDisplay = document.getElementById('score-display'); // æ–°å¢åˆ†æ•¸é¡¯ç¤º
        const startButton = document.getElementById('start-button');

        // --- å•Ÿå‹•å‡½å¼ ---
        function handleStartClick() {
            speak(' '); // å•Ÿå‹•èªéŸ³å¼•æ“
            startGame();
        }

        // --- è¼”åŠ©å‡½å¼ ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) {
                     speechSynthesis.onvoiceschanged = () => speak(text);
                     return; 
                }
                
                let voice = voices.find(v => v.lang === 'en-US' || v.lang === 'en-GB') || voices[0];
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = voice;
                utterance.pitch = 1.0;
                utterance.rate = 0.8; 
                
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(utterance);
            } else {
                instructionArea.textContent = 'ğŸ”Š è«‹æ‰¾å‡º: ' + text;
            }
        }

        function updateDisplay() {
            levelDisplay.textContent = `é—œå¡: ${currentLevel} / ${MAX_LEVELS}`;
            scoreDisplay.textContent = `åˆ†æ•¸: ${score} / ${currentRound}`;
        }

        // --- éŠæˆ²æµç¨‹å‡½å¼ ---

        function startGame() {
            currentLevel = 1; // å¾ç¬¬ä¸€é—œé–‹å§‹
            score = 0;
            currentRound = 0;
            startButton.style.display = 'none';
            // ç”±æ–¼é—œå¡ 1 æ˜¯å­—æ¯æŒ‘æˆ°ï¼Œæ‰€ä»¥ç›´æ¥è¼‰å…¥
            loadCurrentLevel();
        }
        
        /**
         * æª¢æŸ¥é—œå¡æ˜¯å¦çµæŸï¼Œæˆ–æ˜¯å¦å¯ä»¥æ™‰ç´š
         */
        function checkLevelEnd() {
            // å¦‚æœç•¶å‰é—œå¡çš„å°é¡Œæ•¸å·²ç¶“é”åˆ°ä¸Šé™
            if (currentRound >= MAX_ROUNDS) {
                gameArea.innerHTML = '';
                
                // æª¢æŸ¥æ˜¯å¦é”åˆ°æ™‰ç´šæ¨™æº– (9 åˆ†ä»¥ä¸Š)
                if (score >= PASS_SCORE) {
                    currentLevel++; // æ™‰ç´š
                    feedbackArea.textContent = `ğŸ† æ­å–œæ‚¨ï¼æœ¬é—œå¾—åˆ° ${score} åˆ†ï¼Œé”åˆ°æ™‰ç´šæ¨™æº–ï¼`;

                    if (currentLevel > MAX_LEVELS) {
                        endGame(true); // éŠæˆ²é€šé—œ
                        return;
                    }
                    
                    // é€²å…¥ä¸‹ä¸€é—œå‰é‡ç½®åˆ†æ•¸
                    score = 0;
                    currentRound = 0;
                    
                    // å»¶é²å¾Œè¼‰å…¥æ–°é—œå¡
                    setTimeout(() => {
                        feedbackArea.textContent = '';
                        loadCurrentLevel();
                    }, 4000);
                    
                } else {
                    // æœªé”åˆ°æ™‰ç´šæ¨™æº–ï¼Œåœç•™åœ¨ç•¶å‰é—œå¡æˆ–éŠæˆ²çµæŸ
                    feedbackArea.textContent = `ğŸ˜­ æœ¬é—œå¾—åˆ° ${score} åˆ†ï¼Œæœªé” ${PASS_SCORE} åˆ†æ¨™æº–ã€‚`;
                    endGame(false); // æŒ‘æˆ°å¤±æ•—ï¼ŒéŠæˆ²çµæŸ
                }
                return true;
            }
            return false;
        }

        /**
         * è¼‰å…¥ç•¶å‰å¤§é—œå¡çš„ç¬¬ä¸€é¡Œ
         */
        function loadCurrentLevel() {
            const levelType = levelTypes[currentLevel - 1];

            // æ ¹æ“šé¡å‹å‘¼å«å°æ‡‰çš„é¡Œå‹ç”Ÿæˆå™¨
            if (levelType === 'alphabet') {
                loadAlphabetChallenge(); 
            } else if (levelType === 'phonics') {
                loadPhonicsChallenge();
            } else if (levelType === 'addition') {
                loadAdditionChallenge();
            } else if (levelType === 'subtraction') {
                loadSubtractionChallenge();
            }
            
            currentRound++; // å¢åŠ é¡Œè™Ÿ
            updateDisplay();
        }

        function checkAnswer(selectedAnswer, buttonElement) {
            gameArea.querySelectorAll('.game-button').forEach(btn => btn.onclick = null);
            
            const isCorrect = (typeof selectedAnswer === 'string' && selectedAnswer.trim() === targetAnswer.trim()) || 
                              (selectedAnswer == targetAnswer); 

            if (isCorrect) {
                buttonElement.classList.add('correct');
                feedbackArea.textContent = 'ğŸŒŸ ç­”å°äº†ï¼';
                score++; // åŠ åˆ†
                speak('Great job!'); 
            } else {
                buttonElement.classList.add('incorrect');
                gameArea.querySelectorAll('.game-button').forEach(btn => {
                    if (btn.textContent.trim() == targetAnswer) {
                        btn.classList.add('correct');
                    }
                });
                feedbackArea.textContent = `âŒ éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${targetAnswer}ã€‚`;
                speak('Oh no. Try the next one.'); 
            }

            // ç«‹å³æ›´æ–°åˆ†æ•¸é¡¯ç¤º
            updateDisplay();
            
            // å»¶é²å¾Œæª¢æŸ¥é—œå¡æ˜¯å¦çµæŸï¼Œå¦‚æœæ²’çµæŸå°±è¼‰å…¥ä¸‹ä¸€é¡Œ
            setTimeout(() => {
                if (!checkLevelEnd()) {
                    feedbackArea.textContent = '';
                    loadCurrentLevel(); // è¼‰å…¥æœ¬é—œçš„ä¸‹ä¸€é¡Œ
                }
            }, 3000); 
        }

        /**
         * éŠæˆ²é€šé—œæˆ–å¤±æ•—çµæŸ
         * @param {boolean} success - æ˜¯å¦ç‚ºé€šé—œçµæŸ
         */
        function endGame(success) {
            gameArea.innerHTML = '';
            scoreDisplay.textContent = '';

            if (success) {
                instructionArea.textContent = 'ğŸ‰ æ­å–œæ‚¨ï¼æ‚¨å®Œæˆäº†æ‰€æœ‰ 5 å€‹æŒ‘æˆ°ï¼';
                feedbackArea.textContent = 'ä½ æ˜¯æœ€æ£’çš„è¶…ç´šåµæ¢ï¼';
            } else {
                instructionArea.textContent = `æŒ‘æˆ°å¤±æ•—ï¼Œåœç•™åœ¨é—œå¡ ${currentLevel}ã€‚`;
                feedbackArea.textContent = 'æ²’é—œä¿‚ï¼Œå†è©¦ä¸€æ¬¡ï¼Œä½ ä¸€å®šå¯ä»¥ï¼';
            }
            
            startButton.textContent = 'å†ç©ä¸€æ¬¡';
            startButton.onclick = handleStartClick;
            startButton.style.display = 'block';
        }

        // --- é—œå¡å¯¦ä½œï¼šå­—æ¯è½åŠ› (Level 1, 3) ---
        function loadAlphabetChallenge() {
            const levelTargetLetter = ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
            targetAnswer = levelTargetLetter; 

            let choices = new Set([levelTargetLetter]);
            while (choices.size < 4) {
                const randomLetter = ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
                choices.add(randomLetter);
            }
            
            let choicesArray = Array.from(choices);
            shuffle(choicesArray); 

            instructionArea.textContent = `ç¬¬ ${currentRound} é¡Œï¼šè«‹è½è²éŸ³ï¼Œä¸¦é»æ“Šæ‚¨è½åˆ°çš„å­—æ¯ã€‚`;
            renderButtons(choicesArray, 'letter-button');

            setTimeout(() => {
                speak(levelTargetLetter);
            }, 1500);
        }

        // --- é—œå¡å¯¦ä½œï¼šPhonics é¦–å­—æ¯é…å° (Level 2) ---
        function loadPhonicsChallenge() {
            shuffle(PHONICS_WORDS);
            const choicesObjs = PHONICS_WORDS.slice(0, 4);
            const targetWordObj = choicesObjs[Math.floor(Math.random() * 4)];
            targetAnswer = targetWordObj.alt; 

            instructionArea.textContent = `ç¬¬ ${currentRound} é¡Œï¼šè«‹è½é¦–å­—æ¯ç™¼éŸ³ï¼Œé»æ“Šæ­£ç¢ºçš„ç‰©å“ã€‚`;
            
            const alts = choicesObjs.map(obj => obj.alt);
            renderButtons(alts, 'letter-button');

            setTimeout(() => {
                speak(targetWordObj.sound); 
            }, 1500);
        }

        // --- é—œå¡å¯¦ä½œï¼šåŠ æ³• (Level 4) ---
        function loadAdditionChallenge() {
            const num1 = Math.floor(Math.random() * 6) + 1;
            const num2 = Math.floor(Math.random() * 6) + 1;
            const correctAnswer = num1 + num2;
            targetAnswer = correctAnswer.toString();

            instructionArea.textContent = `ç¬¬ ${currentRound} é¡Œï¼šè«‹è¨ˆç®— ${num1} + ${num2} = ?`;
            
            let choices = new Set([correctAnswer]);
            while (choices.size < 3) {
                let wrongAnswer = correctAnswer + (Math.random() > 0.5 ? 1 : -1) * (Math.floor(Math.random() * 3) + 1);
                if (wrongAnswer >= 0 && wrongAnswer !== correctAnswer) {
                    choices.add(wrongAnswer);
                }
            }

            let choicesArray = Array.from(choices).map(n => n.toString());
            shuffle(choicesArray); 

            renderButtons(choicesArray, 'math-button');
        }

        // --- é—œå¡å¯¦ä½œï¼šæ¸›æ³• (Level 5) ---
        function loadSubtractionChallenge() {
            const num1 = Math.floor(Math.random() * 5) + 5;
            const num2 = Math.floor(Math.random() * (num1 - 1)) + 1;
            const correctAnswer = num1 - num2;
            targetAnswer = correctAnswer.toString();

            instructionArea.textContent = `ç¬¬ ${currentRound} é¡Œï¼šè«‹è¨ˆç®— ${num1} - ${num2} = ?`;
            
            let choices = new Set([correctAnswer]);
            while (choices.size < 3) {
                let wrongAnswer = correctAnswer + (Math.random() > 0.5 ? 1 : -1) * (Math.floor(Math.random() * 3) + 1);
                if (wrongAnswer >= 0 && wrongAnswer !== correctAnswer) {
                    choices.add(wrongAnswer);
                }
            }

            let choicesArray = Array.from(choices).map(n => n.toString());
            shuffle(choicesArray); 

            renderButtons(choicesArray, 'math-button');
        }
        
        // --- é€šç”¨æ¸²æŸ“å‡½å¼ ---
        function renderButtons(contents, className) {
            gameArea.innerHTML = '';
            contents.forEach(content => {
                const button = document.createElement('div');
                button.className = 'game-button ' + className;
                button.textContent = content;
                button.onclick = () => checkAnswer(content.toString(), button);
                gameArea.appendChild(button);
            });
        }

        window.onload = () => {
             if ('speechSynthesis' in window) {
                speechSynthesis.getVoices();
             }
        };

    </script>
</body>
</html>
